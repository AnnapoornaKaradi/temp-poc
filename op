/home/curl_user $ echo "$KUBERNETES_SERVICE_HOST" "$KUBERNETES_SERVICE_PORT"
10.0.0.1 443
/home/curl_user $ nslookup kubernetes.default.svc.cluster.local || getent hosts kubernetes.default.svc.cluster.local
Server:         10.0.0.10
Address:        10.0.0.10:53


Name:   kubernetes.default.svc.cluster.local
Address: 10.0.0.1

/home/curl_user $ nc -vz $KUBERNETES_SERVICE_HOST $KUBERNETES_SERVICE_PORT
10.0.0.1 (10.0.0.1:443) open
/home/curl_user $ curl -sS -m 5 https://$KUBERNETES_SERVICE_HOST:$KUBERNETES_SERVICE_PORT/healthz \
>   --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt \env:
curl: (35) Recv failure: Connection reset by peer
curl: (3) URL rejected: Port number was not a decimal number between 0 and 65535
/home/curl_user $
/home/curl_user $
/home/curl_user $
/home/curl_user $
/home/curl_user $   -H "Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)"^C

/home/curl_user $
/home/curl_user $ curl -sS -m 5 https://$KUBERNETES_SERVICE_HOST:$KUBERNETES_SERVICE_PORT/healthz \ --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt \ -H "Authorization: Beare
r $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)"
curl: (35) Recv failure: Connection reset by peer
curl: (3) URL rejected: Malformed input to a URL function
curl: (3) URL rejected: No host part in the URL
curl: (3) URL rejected: Malformed input to a URL function
curl: (3) URL rejected: Malformed input to a URL function



# See if a proxy is set
env | grep -i proxy || true

# Disable any proxy just for this shell
export HTTPS_PROXY= HTTP_PROXY= 
export NO_PROXY="127.0.0.1,localhost,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,*.svc,*.svc.cluster.local,kubernetes.default.svc"
export no_proxy="$NO_PROXY"

# Verify the SA token is there
ls -l /var/run/secrets/kubernetes.io/serviceaccount/
head -c 20 /var/run/secrets/kubernetes.io/serviceaccount/token && echo

# Use the service DNS name (not the IP), and use a single line:
curl -v -m 8 \
  --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt \
  -H "Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)" \
  https://kubernetes.default.svc:443/readyz




/home/curl_user $ curl -v -m 8 \
>   --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt \
>   -H "Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)" \
>   https://kubernetes.default.svc:443/readyz
* Host kubernetes.default.svc:443 was resolved.
* IPv6: (none)
* IPv4: 10.0.0.1
*   Trying 10.0.0.1:443...
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
*  CAfile: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
*  CApath: none
* Recv failure: Connection reset by peer
* TLS connect error: error:00000000:lib(0)::reason(0)
* OpenSSL SSL_connect: Connection reset by peer in connection to kubernetes.default.svc:443
* closing connection #0
curl: (35) Recv failure: Connection reset by peer
/home/curl_user $ exit
command terminated with exit code 35
